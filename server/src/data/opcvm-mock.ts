import { OPCVM, OPCVMCategory, OPCVMHistory } from '../types/opcvm.types';

const now = new Date();

function pseudoRandom(seed: number) {
  const x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

function generateHistory(opcvmId: string, currentVL: number, days = 120): OPCVMHistory[] {
  const history: OPCVMHistory[] = [];
  let vl = currentVL;

  for (let i = days - 1; i >= 0; i--) {
    const noise = (pseudoRandom(i + opcvmId.length) - 0.5) * 0.02; // +/-1%
    const drift = 0.0005; // slow upward drift
    vl = Math.max(1, vl * (1 + drift + noise));

    const date = new Date();
    date.setDate(now.getDate() - i);

    history.push({
      id: `${opcvmId}-hist-${i}`,
      opcvmId,
      vl: parseFloat(vl.toFixed(4)),
      date,
    });
  }

  return history;
}

function previousFromChange(current: number, changePercent?: number): number | undefined {
  if (changePercent === undefined) return undefined;
  const factor = 1 - changePercent / 100;
  return parseFloat((current * factor).toFixed(4));
}

function buildOPCVM(
  base: Omit<OPCVM, 'createdAt' | 'updatedAt' | 'previousVL' | 'isActive'> & {
    dailyChange?: number;
  }
): OPCVM {
  return {
    ...base,
    previousVL: previousFromChange(base.currentVL, base.dailyChange),
    createdAt: now,
    updatedAt: now,
    isActive: true,
  };
}

export const opcvmList: OPCVM[] = [
  buildOPCVM({
    id: 'opcvm-actions-001',
    name: 'Atlas Actions Maroc',
    isin: 'MA000001ATL1',
    managementCompany: 'CDG Capital Gestion',
    category: 'ACTIONS',
    subCategory: 'Large Cap Maroc',
    currentVL: 412.35,
    dailyChange: 0.42,
    weeklyChange: 1.8,
    monthlyChange: 3.4,
    vlDate: now,
    return1Year: 12.4,
    return3Years: 28.1,
    return5Years: 52.3,
    returnSinceInception: 110.2,
    riskLevel: 5,
    managementFee: 1.4,
    minSubscription: 1000,
    inceptionDate: new Date('2016-05-12'),
    assetValue: 1200000000,
    numberOfShares: 2900000,
    description: 'Fonds actions focalise sur les blue-chips marocaines.',
  }),
  buildOPCVM({
    id: 'opcvm-actions-002',
    name: 'Maghreb Equity Growth',
    isin: 'MA000001MEG2',
    managementCompany: 'BMCE Capital Gestion',
    category: 'ACTIONS',
    subCategory: 'Growth',
    currentVL: 267.8,
    dailyChange: -0.18,
    weeklyChange: 0.9,
    monthlyChange: 2.6,
    vlDate: now,
    return1Year: 9.8,
    return3Years: 22.5,
    return5Years: 38.4,
    returnSinceInception: 76.9,
    riskLevel: 4,
    managementFee: 1.5,
    minSubscription: 500,
    inceptionDate: new Date('2018-02-01'),
    assetValue: 680000000,
    numberOfShares: 1800000,
    description: 'Exposition actions Maroc et Afrique du Nord avec biais croissance.',
  }),
  buildOPCVM({
    id: 'opcvm-oblig-001',
    name: 'Saham Obligations Plus',
    isin: 'MA000001SOP3',
    managementCompany: 'Saham Asset Management',
    category: 'OBLIGATIONS',
    subCategory: 'Moyen terme',
    currentVL: 132.45,
    dailyChange: 0.05,
    weeklyChange: 0.2,
    monthlyChange: 0.7,
    vlDate: now,
    return1Year: 4.2,
    return3Years: 12.5,
    return5Years: 19.6,
    returnSinceInception: 44.1,
    riskLevel: 2,
    managementFee: 0.9,
    minSubscription: 100,
    inceptionDate: new Date('2014-11-20'),
    assetValue: 540000000,
    numberOfShares: 4100000,
    description: 'Obligations souveraines marocaines duration 3-5 ans.',
  }),
  buildOPCVM({
    id: 'opcvm-oblig-002',
    name: 'Morocco Bond Mid Term',
    isin: 'MA000001MBT4',
    managementCompany: 'CFG Gestion',
    category: 'OBLIGATIONS',
    subCategory: 'Diversifie',
    currentVL: 158.22,
    dailyChange: -0.03,
    weeklyChange: 0.1,
    monthlyChange: 0.6,
    vlDate: now,
    return1Year: 3.8,
    return3Years: 11.4,
    return5Years: 18.2,
    returnSinceInception: 41.6,
    riskLevel: 2,
    managementFee: 0.85,
    minSubscription: 200,
    inceptionDate: new Date('2015-09-10'),
    assetValue: 320000000,
    numberOfShares: 2100000,
    description: 'Allocation mixte obligations Etat et corporates investment grade.',
  }),
  buildOPCVM({
    id: 'opcvm-monet-001',
    name: 'Cash Plus Monetaire',
    isin: 'MA000001CPM5',
    managementCompany: 'CDG Capital Gestion',
    category: 'MONETAIRE',
    subCategory: 'Court terme',
    currentVL: 108.14,
    dailyChange: 0.01,
    weeklyChange: 0.05,
    monthlyChange: 0.18,
    vlDate: now,
    return1Year: 2.4,
    return3Years: 7.2,
    return5Years: 11.1,
    returnSinceInception: 18.5,
    riskLevel: 1,
    managementFee: 0.4,
    minSubscription: 100,
    inceptionDate: new Date('2020-01-15'),
    assetValue: 760000000,
    numberOfShares: 7000000,
    description: 'Fonds monetaire de tresorerie pour placements de court terme.',
  }),
  buildOPCVM({
    id: 'opcvm-monet-002',
    name: 'Liquidity Pro',
    isin: 'MA000001LQP6',
    managementCompany: 'Upline Capital Management',
    category: 'MONETAIRE',
    subCategory: 'Tresorerie',
    currentVL: 102.95,
    dailyChange: 0.0,
    weeklyChange: 0.04,
    monthlyChange: 0.15,
    vlDate: now,
    return1Year: 2.1,
    return3Years: 6.4,
    return5Years: 9.2,
    returnSinceInception: 12.7,
    riskLevel: 1,
    managementFee: 0.35,
    minSubscription: 100,
    inceptionDate: new Date('2019-06-30'),
    assetValue: 410000000,
    numberOfShares: 3980000,
    description: 'Support de tresorerie pour particuliers et entreprises.',
  }),
  buildOPCVM({
    id: 'opcvm-diver-001',
    name: 'Balanced Diversifie Maroc',
    isin: 'MA000001BDM7',
    managementCompany: 'AXA IM Maroc',
    category: 'DIVERSIFIE',
    subCategory: 'Equilibre',
    currentVL: 189.6,
    dailyChange: 0.22,
    weeklyChange: 0.9,
    monthlyChange: 1.7,
    vlDate: now,
    return1Year: 7.4,
    return3Years: 18.2,
    return5Years: 31.5,
    returnSinceInception: 64.8,
    riskLevel: 3,
    managementFee: 1.1,
    minSubscription: 500,
    inceptionDate: new Date('2017-03-18'),
    assetValue: 880000000,
    numberOfShares: 4630000,
    description: 'Allocation 50/50 entre actions marocaines et obligations souveraines.',
  }),
  buildOPCVM({
    id: 'opcvm-diver-002',
    name: 'Patrimoine Maroc Durable',
    isin: 'MA000001PMD8',
    managementCompany: 'CDG Capital Gestion',
    category: 'DIVERSIFIE',
    subCategory: 'Prudent',
    currentVL: 146.3,
    dailyChange: 0.14,
    weeklyChange: 0.7,
    monthlyChange: 1.4,
    vlDate: now,
    return1Year: 5.9,
    return3Years: 14.7,
    return5Years: 26.2,
    returnSinceInception: 55.3,
    riskLevel: 3,
    managementFee: 1.0,
    minSubscription: 200,
    inceptionDate: new Date('2016-09-25'),
    assetValue: 520000000,
    numberOfShares: 3550000,
    description: 'Approche ESG prudente combinant obligations et selection equity Maroc.',
  }),
  buildOPCVM({
    id: 'opcvm-contract-001',
    name: 'Capital Garantie 2026',
    isin: 'MA000001CG9',
    managementCompany: 'Attijari Asset Management',
    category: 'CONTRACTUEL',
    subCategory: 'Garanti',
    currentVL: 101.9,
    dailyChange: 0.0,
    weeklyChange: 0.05,
    monthlyChange: 0.12,
    vlDate: now,
    return1Year: 3.1,
    return3Years: 8.3,
    return5Years: 12.6,
    returnSinceInception: 18.9,
    riskLevel: 2,
    managementFee: 0.8,
    minSubscription: 1000,
    inceptionDate: new Date('2021-04-01'),
    assetValue: 260000000,
    numberOfShares: 2550000,
    description: 'Fonds a capital protege avec maturite 2026.',
  }),
  buildOPCVM({
    id: 'opcvm-alt-001',
    name: 'Infra Yield Maroc',
    isin: 'MA000001IYM0',
    managementCompany: 'Aradei Gestion',
    category: 'ALTERNATIF',
    subCategory: 'Infrastructure',
    currentVL: 128.4,
    dailyChange: 0.08,
    weeklyChange: 0.6,
    monthlyChange: 1.3,
    vlDate: now,
    return1Year: 8.1,
    return3Years: 20.6,
    return5Years: 33.8,
    returnSinceInception: 57.2,
    riskLevel: 4,
    managementFee: 1.6,
    minSubscription: 5000,
    inceptionDate: new Date('2017-11-03'),
    assetValue: 470000000,
    numberOfShares: 3650000,
    description: 'Exposition infrastructures marocaines et PPP yield.',
  }),
  buildOPCVM({
    id: 'opcvm-actions-003',
    name: 'Africa ESG Actions',
    isin: 'MA000001AES1',
    managementCompany: 'CIH Asset Management',
    category: 'ACTIONS',
    subCategory: 'ESG',
    currentVL: 176.9,
    dailyChange: 0.36,
    weeklyChange: 1.3,
    monthlyChange: 2.9,
    vlDate: now,
    return1Year: 10.6,
    return3Years: 24.2,
    return5Years: 40.7,
    returnSinceInception: 75.1,
    riskLevel: 5,
    managementFee: 1.6,
    minSubscription: 300,
    inceptionDate: new Date('2018-07-07'),
    assetValue: 390000000,
    numberOfShares: 2200000,
    description: 'Actions Maroc et Afrique avec filtre ESG et gouvernance.',
  }),
  buildOPCVM({
    id: 'opcvm-oblig-003',
    name: 'Obli Court Terme Pro',
    isin: 'MA000001OCT2',
    managementCompany: 'Valoris Management',
    category: 'OBLIGATIONS',
    subCategory: 'Court terme',
    currentVL: 104.7,
    dailyChange: 0.02,
    weeklyChange: 0.08,
    monthlyChange: 0.25,
    vlDate: now,
    return1Year: 2.9,
    return3Years: 8.7,
    return5Years: 13.5,
    returnSinceInception: 21.4,
    riskLevel: 1,
    managementFee: 0.6,
    minSubscription: 100,
    inceptionDate: new Date('2019-03-10'),
    assetValue: 310000000,
    numberOfShares: 2960000,
    description: 'Obligations court terme et billets de tresorerie.',
  }),
  buildOPCVM({
    id: 'opcvm-diver-003',
    name: 'Global Multi-Strategy',
    isin: 'MA000001GMS3',
    managementCompany: 'BMCI Asset Management',
    category: 'DIVERSIFIE',
    subCategory: 'Flexible',
    currentVL: 205.4,
    dailyChange: 0.27,
    weeklyChange: 1.4,
    monthlyChange: 3.1,
    vlDate: now,
    return1Year: 9.9,
    return3Years: 23.1,
    return5Years: 36.4,
    returnSinceInception: 70.5,
    riskLevel: 4,
    managementFee: 1.3,
    minSubscription: 1000,
    inceptionDate: new Date('2016-12-02'),
    assetValue: 560000000,
    numberOfShares: 2720000,
    description: 'Allocation flexible actions/obligations avec overlay de couverture.',
  }),
  buildOPCVM({
    id: 'opcvm-actions-004',
    name: 'Tech Disrupt Maroc',
    isin: 'MA000001TDM4',
    managementCompany: 'CFG Gestion',
    category: 'ACTIONS',
    subCategory: 'Thematique',
    currentVL: 154.2,
    dailyChange: -0.22,
    weeklyChange: 0.5,
    monthlyChange: 1.9,
    vlDate: now,
    return1Year: 11.8,
    return3Years: 27.4,
    return5Years: 45.9,
    returnSinceInception: 68.7,
    riskLevel: 6,
    managementFee: 1.9,
    minSubscription: 500,
    inceptionDate: new Date('2018-10-11'),
    assetValue: 240000000,
    numberOfShares: 1550000,
    description: 'Exposition aux valeurs technologiques et innovation locale.',
  }),
  buildOPCVM({
    id: 'opcvm-monet-003',
    name: 'Secure Money Market',
    isin: 'MA000001SMM5',
    managementCompany: 'Sogecapital Gestion',
    category: 'MONETAIRE',
    subCategory: 'Court terme',
    currentVL: 101.5,
    dailyChange: 0.0,
    weeklyChange: 0.03,
    monthlyChange: 0.11,
    vlDate: now,
    return1Year: 1.9,
    return3Years: 5.8,
    return5Years: 8.6,
    returnSinceInception: 10.9,
    riskLevel: 1,
    managementFee: 0.3,
    minSubscription: 50,
    inceptionDate: new Date('2020-07-01'),
    assetValue: 180000000,
    numberOfShares: 1770000,
    description: 'Tresorerie defensive pour parkings court terme.',
  }),
  buildOPCVM({
    id: 'opcvm-alt-002',
    name: 'Real Estate Income',
    isin: 'MA000001REI6',
    managementCompany: 'REIM Maroc',
    category: 'ALTERNATIF',
    subCategory: 'Immobilier',
    currentVL: 142.7,
    dailyChange: 0.11,
    weeklyChange: 0.8,
    monthlyChange: 1.6,
    vlDate: now,
    return1Year: 7.6,
    return3Years: 19.4,
    return5Years: 31.1,
    returnSinceInception: 49.8,
    riskLevel: 4,
    managementFee: 1.4,
    minSubscription: 2000,
    inceptionDate: new Date('2017-04-14'),
    assetValue: 330000000,
    numberOfShares: 2310000,
    description: 'Fonds immobilier revenu avec distribution annuelle.',
  }),
];

export const opcvmHistoryMap: Record<string, OPCVMHistory[]> = {};

opcvmList.forEach((fund) => {
  opcvmHistoryMap[fund.id] = generateHistory(fund.id, fund.currentVL);
});
